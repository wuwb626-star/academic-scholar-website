<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Publications | Peiqi Yang</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
  <style>
    :root{
      --bg:#ffffff; --fg:#1f2937; --muted:#6b7280; --brand:#2563eb; --card:#f8fafc; --border:#e5e7eb;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";margin:0;color:var(--fg);background:var(--bg)}
    header{position:sticky;top:0;z-index:50;background:rgba(255,255,255,.85);backdrop-filter:saturate(180%) blur(10px);border-bottom:1px solid var(--border)}
    .container{max-width:980px;margin:0 auto;padding:20px}
    .title{display:flex;align-items:center;gap:12px;font-weight:700}
    .title h1{font-size:clamp(22px,3vw,28px);margin:0}
    nav{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .tab{appearance:none;border:1px solid var(--border);background:#fff;color:var(--fg);padding:10px 14px;border-radius:999px;cursor:pointer;font-weight:600}
    .tab[aria-pressed="true"]{background:var(--brand);color:#fff;border-color:var(--brand)}
    .bar{display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-top:14px}
    .search{flex:1;min-width:240px;display:flex;align-items:center;border:1px solid var(--border);border-radius:999px;padding:8px 12px;background:#fff}
    .search input{flex:1;border:0;outline:none;font-size:14px;background:transparent}
    .count{font-size:13px;color:var(--muted)}

    /* List */
    .list{margin:22px 0;display:grid;gap:12px}
    .card{border:1px solid var(--border);background:#fff;border-radius:var(--radius);padding:16px;transition:transform .08s ease, box-shadow .2s ease, border-color .2s ease}
    .card:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(2,6,23,.06);border-color:#dbeafe}
    .year-chip{display:inline-flex;align-items:center;gap:6px;padding:2px 10px;border-radius:999px;background:var(--card);border:1px solid var(--border);font-size:12px;color:var(--muted);margin-bottom:8px}
    .title-row{font-size:16px;line-height:1.4;margin:4px 0 8px 0}
    .title-row i{font-style:italic}
    .authors{font-size:14px;color:var(--fg);font-weight:600}
    .meta{font-size:13px;color:var(--muted)}
    .tags{margin-top:8px;display:flex;gap:8px;flex-wrap:wrap}
    .tag{font-size:11px;color:var(--muted);border:1px dashed var(--border);padding:4px 8px;border-radius:999px;background:#fff}

    .year-group{border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;background:#fff}
    .year-header{display:flex;align-items:center;justify-content:space-between;padding:10px 14px;cursor:pointer;background:var(--card);user-select:none}
    .year-header h3{margin:0;font-size:14px;font-weight:700;letter-spacing:.2px}
    .year-header .muted{font-size:12px;color:var(--muted)}
    .year-body{padding:12px;display:grid;gap:12px;border-top:1px solid var(--border)}
    .chev{transition:transform .18s ease}
    .collapsed .chev{transform:rotate(-90deg)}

    /* Highlight selected */
    .card.is-selected.hl{border-color:#60a5fa;box-shadow:0 6px 24px rgba(2,6,23,.08);}
    .card.is-selected.hl .year-chip{background:#eaf2ff;color:#2563eb;border-color:#bfdbfe}

    footer{border-top:1px solid var(--border);margin-top:28px}
    footer .container{font-size:12px;color:var(--muted)}

    /* Empty state */
    .empty{padding:36px;border:1px dashed var(--border);border-radius:var(--radius);text-align:center;background:var(--card);color:var(--muted)}

    @media (prefers-color-scheme: dark){
      :root{ --bg:#0b1020;--fg:#e5e7eb;--muted:#94a3b8;--brand:#60a5fa;--card:#0f172a;--border:#1f2a44 }
      header{background:rgba(11,16,32,.7)}
      .tab{background:#0f172a;border-color:#1f2a44;color:var(--fg)}
      .search{background:#0f172a;border-color:#1f2a44}
      .card{background:#0f172a;border-color:#1f2a44}
      .empty{background:#0f172a;border-color:#1f2a44}
    }
  </style>
</head>
<body>
  <header>
    <div class="container">
      <div class="title">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M4 6.5A2.5 2.5 0 0 1 6.5 4h8.75A2.75 2.75 0 0 1 18 6.75V18l-5-2-5 2V6.5Z" stroke="currentColor" stroke-width="1.5"/></svg>
        <h1>Publications</h1>
      </div>
      <nav>
        <button class="tab" id="tab-selected" aria-pressed="true">Selected</button>
        <button class="tab" id="tab-all" aria-pressed="false">Full list</button>
      </nav>
      <div class="bar">
        <label class="search" aria-label="Search publications">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M11 19a8 8 0 1 1 5.3-14.02A8 8 0 0 1 11 19Zm9.5 2.5L17 18" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>
          <input id="q" type="search" placeholder="Search author, title, journal, year…" />
        </label>
        <label style="display:flex;align-items:center;gap:8px;font-size:13px;color:var(--muted)">
          <input id="hl" type="checkbox" /> Highlight Selected
        </label>
        <div class="count" id="count">Loading…</div>
      </div>
      </div>
    </div>
  </header>

  <main>
    <div class="container">
      <div id="list" class="list" role="list"></div>
      <div id="empty" class="empty" hidden>No matching publications. Try different keywords.</div>
    </div>
  </main>

  <footer>
    <div class="container">© <span id="yy"></span> Peiqi Yang • Simple, toggleable list • CSV-powered</div>
  </footer>

  <script>
    document.getElementById('yy').textContent = new Date().getFullYear();

    // State
    const state = { mode: 'selected', q: '', highlight: false, collapsed: new Set() };

    // Elements
    const elList = document.getElementById('list');
    const elCount = document.getElementById('count');
    const elEmpty = document.getElementById('empty');
    const elQ = document.getElementById('q');
    const elHL = document.getElementById('hl');
    const tabSelected = document.getElementById('tab-selected');
    const tabAll = document.getElementById('tab-all');

    // Handlers for tabs
    function setMode(mode){
      state.mode = mode;
      tabSelected.setAttribute('aria-pressed', mode==='selected');
      tabAll.setAttribute('aria-pressed', mode==='all');
      render();
    }
    tabSelected.addEventListener('click', ()=> setMode('selected'));
    tabAll.addEventListener('click', ()=> setMode('all'));

    // Search
    elQ.addEventListener('input', () => { state.q = elQ.value.trim().toLowerCase(); render();});
    elHL.addEventListener('change', () => { state.highlight = elHL.checked; render();}); render();});

    // Load CSV (expects citations.csv next to this file)
    let rows = [{"Authors": "Yang, Peiqi; Verhoef, Wout; Van der Tol, Christiaan;", "Title": "Unified four-stream radiative transfer theory in the near-infrared region for vegetation canopies, with consideration of fluorescence for multi-layer vegetation canopies", "Publication": "Remote Sensing", "Volume": "12", "Number": "23", "Pages": "3914", "Year": "2020", "Publisher": "MDPI", "DOI": "", "URL": "", "selected": ""}, {"Authors": "Yang, Peiqi; Ma, Qin; Liu, Jing;", "Title": "Downscaling canopy photochemical reflectance index to leaf level by correcting for the soil effects", "Publication": "Remote Sensing of Environment", "Volume": "311", "Number": "", "Pages": "114250", "Year": "2024", "Publisher": "Elsevier", "DOI": "", "URL": "", "selected": ""}, {"Authors": "Yang, Peiqi; Liu, Jing; ", "Title": "Variations and influencing factors of effective yield for transect-based laser scanning of conifer crowns", "Publication": "Agricultural and Forest Meteorology", "Volume": "316", "Number": "", "Pages": "108907", "Year": "2022", "Publisher": "Elsevier", "DOI": "", "URL": "", "selected": ""}];
    // Normalize & sort
    rows = (rows || []).map(r=>({
      Authors: r.Authors?.trim()||'',
      Title: r.Title?.trim()||'',
      Publication: r.Publication?.trim()||'',
      Volume: r.Volume?.toString().trim()||'',
      Number: r.Number?.toString().trim()||'',
      Pages: r.Pages?.toString().trim()||'',
      Year: r.Year?.toString().trim()||'',
      Publisher: r.Publisher?.trim()||'',
      DOI: r.DOI?.trim()||'',
      URL: r.URL?.trim()||'',
      selected: (r.selected||r.Selected||r.is_selected||'').toString().trim().toLowerCase()
    }));
    rows.sort((a,b)=> (b.Year||'').localeCompare(a.Year||'') || a.Title.localeCompare(b.Title));
    render();
        // Sort by year desc then title
        rows.sort((a,b)=> (b.Year||'').localeCompare(a.Year||'') || a.Title.localeCompare(b.Title));
        render();
      },
      error: () => {
        elCount.textContent = 'Failed to load citations.csv. Please place it next to this HTML.';
      }
    });

    // Rendering
    function passFilters(r){
      if(state.mode==='selected' && r.selected!=='y' && r.selected!=='yes' && r.selected!=='1') return false;
      if(!state.q) return true;
      const hay = `${r.Authors} ${r.Title} ${r.Publication} ${r.Year} ${r.Publisher}`.toLowerCase();
      return hay.includes(state.q);
    }

    function fmt(r){
      const partVolNum = r.Volume ? (r.Number ? `${r.Volume}(${r.Number})` : r.Volume) : '';
      const partPages = r.Pages ? r.Pages : '';
      const partYear = r.Year ? ` (${r.Year})` : '';
      const journalBits = [r.Publication, partVolNum, partPages].filter(Boolean).join(', ');
      const meta = journalBits + partYear + (r.Publisher? ` • ${r.Publisher}`:'');
      const href = r.DOI ? `https://doi.org/${r.DOI.replace(/^https?:\/\/doi\.org\//,'')}` : (r.URL||'');
      const selected = (r.selected==='y' || r.selected==='yes' || r.selected==='1');
      const cardClass = `card ${selected? 'is-selected':''} ${state.highlight? 'hl':''}`.trim();
      return `
        <article class="${cardClass}" role="listitem">
          <span class="year-chip" title="Year">${r.Year || '—'}</span>
          <div class="title-row"><i>${escapeHTML(r.Title || 'Untitled')}</i></div>
          <div class="authors">${escapeHTML(r.Authors)}</div>
          <div class="meta">${escapeHTML(meta)}</div>
          <div class="tags">
            ${r.DOI? `<a class="tag" href="${href}" target="_blank" rel="noopener">DOI</a>`:''}
            ${r.URL && !r.DOI? `<a class="tag" href="${r.URL}" target="_blank" rel="noopener">Link</a>`:''}
            ${selected ? '<span class="tag">Selected</span>' : ''}
          </div>
        </article>`;
    }(${r.Number})` : r.Volume) : '';
      const partPages = r.Pages ? r.Pages : '';
      const partYear = r.Year ? ` (${r.Year})` : '';
      const journalBits = [r.Publication, partVolNum, partPages].filter(Boolean).join(', ');
      const meta = journalBits + partYear + (r.Publisher? ` • ${r.Publisher}`:'');
      const href = r.DOI ? `https://doi.org/${r.DOI.replace(/^https?:\/\/doi\.org\//,'')}` : (r.URL||'');
      return `
        <article class="card" role="listitem">
          <span class="year-chip" title="Year">${r.Year || '—'}</span>
          <div class="title-row"><i>${escapeHTML(r.Title || 'Untitled')}</i></div>
          <div class="authors">${escapeHTML(r.Authors)}</div>
          <div class="meta">${escapeHTML(meta)}</div>
          <div class="tags">
            ${r.DOI? `<a class="tag" href="${href}" target="_blank" rel="noopener">DOI</a>`:''}
            ${r.URL && !r.DOI? `<a class="tag" href="${r.URL}" target="_blank" rel="noopener">Link</a>`:''}
            ${r.selected==='y' || r.selected==='yes' || r.selected==='1' ? '<span class="tag">Selected</span>' : ''}
          </div>
        </article>`;
    }

    function render(){
      const filtered = rows.filter(passFilters);
      // group by year
      const groups = new Map();
      for(const r of filtered){
        const y = r.Year || '—';
        if(!groups.has(y)) groups.set(y, []);
        groups.get(y).push(r);
      }
      // sort years desc (numeric where possible)
      const years = Array.from(groups.keys()).sort((a,b)=> (b+a).localeCompare(a+a));
      let html = '';
      for(const y of years){
        const list = groups.get(y);
        const collapsed = state.collapsed.has(y);
        html += `<section class="year-group ${collapsed? 'collapsed':''}">
          <div class="year-header" onclick="toggleYear('${y.replace(/'/g, "&#39;")}')" role="button" aria-expanded="${!collapsed}">
            <h3>${y}</h3>
            <div class="muted">${list.length} item${list.length>1?'s':''}
              <svg class="chev" width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path d="M8 10l4 4 4-4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </div>
          </div>
          <div class="year-body" style="display:${collapsed? 'none':'grid'}">`;
        html += list.map(fmt).join('');
        html += '</div></section>';
      }
      elList.innerHTML = html;
      elCount.textContent = filtered.length ? `${filtered.length} result${filtered.length>1?'s':''}` : '0 results';
      elEmpty.hidden = filtered.length>0;
    }
    window.toggleYear = function(y){
      if(state.collapsed.has(y)) state.collapsed.delete(y); else state.collapsed.add(y);
      render();
    } result${filtered.length>1?'s':''}` : '0 results';
      elEmpty.hidden = filtered.length>0;
    }

    // Minimal HTML escaping
    function escapeHTML(s){
      return (s||'').replace(/[&<>\"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;'}[c]));
    }
  </script>
</body>
</html>
